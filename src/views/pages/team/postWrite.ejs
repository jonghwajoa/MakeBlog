<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>WeKnowJS-글작성</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <% include ../../partials/team/essentialCss.ejs %>
    <link rel="stylesheet" href="/css/team/postWrite.css" />
    <% include ../../partials/team/editorWrite.ejs %>
  </head>

  <body>
    <% include ../../partials/team/header.ejs %>

    <article>
      <section>
        <div class="custom title">
          <input type="text" id="title" name="title" placeholder="Title" />
        </div>
        <div class="custom tag">
          <input type="text" id="tag" name="tag" placeholder="Tag" />
        </div>
        <div class="category">
          <label for="category">category</label>
          <select name="category" id="category">
            <% category.forEach((item,idx) => { %>
            <option value="<%=item.no%>"><%=item.explain %> </option>
            <% }) %>
          </select>
        </div>

        <div>
          <input
            type="text"
            id="addCategory"
            name="addCategory"
            placeholder="Category add name"
          />
          <button onclick="addCategory()">추가하기</button>
        </div>

        <div id="editSection" id="content" name="content"></div>

        <button class="custom" onclick="back()">뒤로가기</button>
        <button class="custom" id="submit" onclick="postWrite.submit()">
          작성하기
        </button>
      </section>
    </article>

    <% include ../../partials/footer.ejs %>
    <script src="/js/util/ajaxUtil.js"></script>
    <script src="/js/post/postWrite.js"></script>

    <script>
      function addCategory() {
        const categoryName = document.getElementById('addCategory').value;
        const selectBox = document.getElementById('category');
        const xhr = new XMLHttpRequest();
        xhr.onload = function() {
          if (xhr.status === 200) {
            let select = document.createElement('option');
            let result = JSON.parse(xhr.responseText);
            select.text = categoryName;
            select.value = result.no;
            selectBox.options.add(select);
            alert(result.message);
          } else if (xhr.status === 400) {
            alert(`${xhr.responseText}`);
          } else {
            alert(`Error \n${xhr.responseText}`);
          }
        };
        xhr.open('POST', '/post/category/', true);
        xhr.setRequestHeader('Content-type', 'application/json');
        xhr.send(JSON.stringify({ categoryName }));
      }
    </script>
  </body>
</html>
